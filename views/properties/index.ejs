<% layout('layouts/boilerplate.ejs') %>
<link rel="stylesheet" href="/stylesheets/index.css" />

<h2 class="index-heading">All Properties</h2>
<div id="cluster-map" class="mb-3"></div>
<div class="card-container">
	<% for (let i=1; i<=12; i++) {%>
	<div class="card">
		<div class="card__left">
			<img
				class="card__image"
				alt=""
				src="<%= properties[i].images[0].url %>"
				loading="lazy" />
		</div>
		<div class="card__right">
			<div class="card__right--inner">
				<span class="card__heading">
					<h5 class="card__title"><%= properties[i].title %></h5>
					<small class="text__location"
						><%= properties[i].location %></small
					></span
				>
				<p class="card__text"><%= properties[i].description %></p>
			</div>

			<a class="btn btn-primary" href="/properties/<%= properties[i]._id %>"
				>View <%= properties[i].title %></a
			>
		</div>
	</div>
	<% } %>
</div>

<script>
	// Pass the token needed for map to work
	const mapToken = '<%-process.env.MAPBOX_TOKEN%>';
	// Pass the data to be displayed by cluster map
	// Mapbox expects the data to be inside "features" object
	const properties = {features: <%-JSON.stringify(properties)%>};
</script>
<script src="/javascripts/clusterMap.js"></script>
